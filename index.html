<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المراجعة النهائية: علم الفرائض</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@500;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #0f5132; /* لون إسلامي/أكاديمي */
            --secondary-color: #d4ac0d; /* ذهبي */
            --bg-light: #f8f9fa;
            --text-dark: #2c3e50;
        }
        
        body {
            font-family: 'Amiri', serif;
            background-color: #f4f6f7;
            color: var(--text-dark);
            line-height: 1.8;
        }

        h1, h2, h3, h4, .btn {
            font-family: 'Tajawal', sans-serif;
        }

        .header-section {
            background: linear-gradient(135deg, var(--primary-color), #146c43);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
            border-bottom: 5px solid var(--secondary-color);
        }

        .card-custom {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s;
            margin-bottom: 1.5rem;
            background: white;
            overflow: hidden;
        }

        .card-custom:hover {
            transform: translateY(-5px);
        }

        .card-header-custom {
            background-color: rgba(15, 81, 50, 0.05);
            border-bottom: 2px solid var(--secondary-color);
            padding: 1rem;
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        .highlight-box {
            background-color: #e8f5e9;
            border-right: 4px solid var(--primary-color);
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .share-badge {
            font-size: 1.1em;
            background-color: var(--primary-color);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 10px;
        }

        /* Calculator Styles */
        .calc-section {
            background-color: #fff;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-top: 5px solid var(--secondary-color);
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .checkbox-wrapper:hover {
            background-color: #f8f9fa;
            border-color: var(--primary-color);
        }

        .checkbox-wrapper input {
            width: 20px;
            height: 20px;
            margin-left: 10px;
            accent-color: var(--primary-color);
        }

        .result-table th {
            background-color: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body>

    <div class="header-section text-center">
        <div class="container">
            <h1><i class="fas fa-balance-scale"></i> الجامع في علم الفرائض</h1>
            <p class="lead mt-2">ملخص شامل للتحضير للامتحان + حاسبة المواريث</p>
            <span class="badge bg-warning text-dark p-2">بناءً على الملف المرفق [faroizz.txt]</span>
        </div>
    </div>

    <div class="container mb-5">
        
        <div class="row">
            <div class="col-md-6">
                <div class="card card-custom h-100">
                    <div class="card-header-custom"><i class="fas fa-book-open ms-2"></i> تعريفات أساسية</div>
                    <div class="card-body">
                        <ul class="list-unstyled">
                            [cite_start]<li class="mb-3"><strong>الميراث لغة:</strong> البقاء وانتقال الشيء من شخص لآخر[cite: 187].</li>
                            [cite_start]<li class="mb-3"><strong>اصطلاحاً:</strong> انتقال ملك أحد بسبب الموت إلى ورثته الشرعية[cite: 189].</li>
                            [cite_start]<li class="mb-3"><strong>الفرائض:</strong> جمع فريضة (مقدرة)، وهو العلم بالسهام المقدرة ومستحقيها[cite: 194].</li>
                            [cite_start]<li><strong>التركة:</strong> ما يتركه الميت من أموال وحقوق[cite: 190].</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card card-custom h-100">
                    <div class="card-header-custom"><i class="fas fa-columns ms-2"></i> الأركان والشروط</div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-4 border-start">
                                <h5 class="text-success">الأركان</h5>
                                [cite_start]<small>المورث، الوارث، الموروث [cite: 223]</small>
                            </div>
                            <div class="col-4 border-start">
                                <h5 class="text-success">الأسباب</h5>
                                [cite_start]<small>الزوجية، القرابة، الولاء [cite: 224]</small>
                            </div>
                            <div class="col-4">
                                <h5 class="text-success">الشروط</h5>
                                [cite_start]<small>موت المورث، حياة الوارث، انتفاء الموانع [cite: 227]</small>
                            </div>
                        </div>
                        <div class="alert alert-danger mt-3 mb-0 p-2">
                            [cite_start]<strong>موانع الإرث:</strong> الرق، القتل، اختلاف الدين، اختلاف الدارين[cite: 250].
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card card-custom">
            [cite_start]<div class="card-header-custom"><i class="fas fa-list-ol ms-2"></i> الحقوق المتعلقة بالتركة (بالترتيب) [cite: 230]</div>
            <div class="card-body">
                <div class="d-flex justify-content-between text-center d-none d-md-flex">
                    <div class="flex-fill p-2 border-end">1. التجهيز والكفن</div>
                    <div class="flex-fill p-2 border-end">2. قضاء الديون</div>
                    <div class="flex-fill p-2 border-end">3. تنفيذ الوصايا (من الثلث)</div>
                    <div class="flex-fill p-2">4. تقسيم الإرث</div>
                </div>
                <ul class="d-md-none">
                    <li>التجهيز والكفن</li>
                    <li>قضاء الديون</li>
                    <li>تنفيذ الوصايا</li>
                    <li>تقسيم الإرث</li>
                </ul>
            </div>
        </div>

        <h3 class="mt-5 mb-4 text-center section-title">أصحاب الفروض والسهام المقدرة</h3>
        [cite_start]<p class="text-center text-muted">السهام في كتاب الله ستة: النصف، الربع، الثمن، الثلثان، الثلث، السدس [cite: 260]</p>
        
        <div class="row g-4">
            <div class="col-md-4">
                <div class="card card-custom h-100">
                    <div class="card-body text-center">
                        <div class="share-badge">النصف (1/2)</div>
                        <ul class="list-group list-group-flush text-start">
                            [cite_start]<li class="list-group-item"><strong>الزوج:</strong> عند عدم الفرع الوارث[cite: 281].</li>
                            [cite_start]<li class="list-group-item"><strong>البنت:</strong> الواحدة المنفردة[cite: 288].</li>
                            [cite_start]<li class="list-group-item"><strong>بنت الابن:</strong> الواحدة عند عدم البنت[cite: 289].</li>
                            [cite_start]<li class="list-group-item"><strong>الأخت ش:</strong> الواحدة المنفردة[cite: 295].</li>
                            [cite_start]<li class="list-group-item"><strong>الأخت لأب:</strong> الواحدة المنفردة[cite: 299].</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card card-custom h-100">
                    <div class="card-body text-center">
                        <div class="share-badge">الربع (1/4) والثمن (1/8)</div>
                        <ul class="list-group list-group-flush text-start">
                            [cite_start]<li class="list-group-item"><strong>الربع للزوج:</strong> مع وجود الفرع الوارث[cite: 282].</li>
                            [cite_start]<li class="list-group-item"><strong>الربع للزوجة:</strong> عند عدم الفرع الوارث[cite: 285].</li>
                            [cite_start]<li class="list-group-item bg-light"><strong>الثمن للزوجة:</strong> مع وجود الفرع الوارث[cite: 286].</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card card-custom h-100">
                    <div class="card-body text-center">
                        <div class="share-badge">الثلثان (2/3)</div>
                        <div class="text-muted small mb-2">للاثنتين فصاعداً من النساء</div>
                        <ul class="list-group list-group-flush text-start">
                            [cite_start]<li class="list-group-item">البنات الصلبيات[cite: 289].</li>
                            [cite_start]<li class="list-group-item">بنات الابن (عند عدم البنات)[cite: 289].</li>
                            [cite_start]<li class="list-group-item">الأخوات الشقيقات[cite: 296].</li>
                            [cite_start]<li class="list-group-item">الأخوات لأب[cite: 300].</li>
                        </ul>
                    </div>
                </div>
            </div>

             <div class="col-md-12">
                <div class="card card-custom">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 border-end">
                                <h5 class="text-center text-primary">الثلث (1/3)</h5>
                                <ul>
                                    [cite_start]<li><strong>الأم:</strong> عند عدم الفرع الوارث وعدم الجمع من الإخوة[cite: 312].</li>
                                    [cite_start]<li><strong>أولاد الأم (الإخوة لأم):</strong> للاثنين فصاعداً (بالتساوي)[cite: 279].</li>
                                    [cite_start]<li><strong>الأم (ثلث الباقي):</strong> في المسألتين العمريتين (مع أحد الزوجين والأب)[cite: 313].</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5 class="text-center text-primary">السدس (1/6)</h5>
                                <p class="small text-center">أكثر الفروض شيوعاً</p>
                                <div class="row">
                                    <div class="col-6">
                                        <ul>
                                            [cite_start]<li><strong>الأب:</strong> مع الفرع الذكر[cite: 269].</li>
                                            [cite_start]<li><strong>الأم:</strong> مع الفرع الوارث أو جمع الإخوة[cite: 308].</li>
                                            [cite_start]<li><strong>الجد:</strong> مثل الأب عند عدمه[cite: 272].</li>
                                        </ul>
                                    </div>
                                    <div class="col-6">
                                        <ul>
                                            [cite_start]<li><strong>الجدة:</strong> الواحدة أو أكثر[cite: 316].</li>
                                            [cite_start]<li><strong>بنت الابن:</strong> تكملة الثلثين مع البنت[cite: 289].</li>
                                            [cite_start]<li><strong>الأخت لأب:</strong> تكملة الثلثين مع الشقيقة[cite: 301].</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card card-custom mt-4 border-warning">
            <div class="card-header-custom bg-warning bg-opacity-10 text-dark">
                <i class="fas fa-ban ms-2"></i> الحجب (قواعد ذهبية للامتحان)
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="highlight-box">
                            <strong>الورثة الذين لا يسقطون أبداً (6):</strong>
                            [cite_start]<br>الابن، البنت، الأب، الأم، الزوج، الزوجة[cite: 363].
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="highlight-box">
                            <strong>قاعدة الحجب:</strong>
                            [cite_start]<br>كل من أدلى إلى الميت بواسطة حجبته تلك الواسطة (إلا أولاد الأم يرثون مع الأم)[cite: 364].
                        </div>
                    </div>
                </div>
                <table class="table table-sm mt-3">
                    <thead class="table-dark">
                        <tr>
                            <th>النوع</th>
                            <th>التعريف</th>
                            <th>مثال</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>حجب حرمان</td>
                            [cite_start]<td>المنع من الميراث بالكلية [cite: 357]</td>
                            <td>الجد يحجب بالأب، ابن الابن يحجب بالابن.</td>
                        </tr>
                        <tr>
                            <td>حجب نقصان</td>
                            [cite_start]<td>الانتقال من سهم أكبر لأصغر [cite: 356]</td>
                            <td>الزوج من 1/2 إلى 1/4 بسبب الولد.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="calc-section mt-5" id="calculator">
            <h2 class="text-center mb-4"><i class="fas fa-calculator text-success"></i> حاسبة الميراث المبسطة</h2>
            <p class="text-center text-muted">حساب لأصحاب الفروض الأساسيين الذين لا يسقطون (الستة) بناءً على قواعد الملف.</p>
            
            <div class="row">
                <div class="col-lg-5 order-lg-2">
                    <div class="mb-3">
                        <label class="form-label fw-bold">قيمة التركة (المال):</label>
                        <input type="number" id="estateValue" class="form-control" placeholder="أدخل المبلغ هنا (مثلاً 12000)">
                    </div>

                    <h5 class="mt-4 mb-3 border-bottom pb-2">اختر الورثة الموجودين:</h5>
                    
                    <div class="mb-3 p-2 border rounded bg-light">
                        <label class="fw-bold d-block mb-2">نوع الميت:</label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="deceasedGender" id="genderMale" value="male" checked onclick="toggleSpouse()">
                            <label class="form-check-label" for="genderMale">رجل (يوجد زوجة)</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="deceasedGender" id="genderFemale" value="female" onclick="toggleSpouse()">
                            <label class="form-check-label" for="genderFemale">امرأة (يوجد زوج)</label>
                        </div>
                    </div>

                    <div class="checkbox-wrapper" id="spouseDiv">
                        <input type="checkbox" id="hasSpouse">
                        <label for="hasSpouse" id="spouseLabel">الزوجة</label>
                    </div>

                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="hasFather">
                        <label for="hasFather">الأب</label>
                    </div>

                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="hasMother">
                        <label for="hasMother">الأم</label>
                    </div>

                    <div class="row g-2">
                        <div class="col-6">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="hasSon">
                                <label for="hasSon">الابن (وإن تعدد)</label>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="hasDaughter">
                                <label for="hasDaughter">البنت (وإن تعددت)</label>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <label class="small text-muted">* هذه الحاسبة تفترض وجود فرد واحد لكل صنف لغرض التوضيح، وتعدد الأبناء/البنات يتم بجمعهم في خانة الباقي.</label>
                    </div>

                    <button class="btn btn-success w-100 mt-4 py-2 fw-bold" onclick="calculateInheritance()">
                        <i class="fas fa-coins ms-1"></i> احسب القسمة
                    </button>
                </div>

                <div class="col-lg-7 order-lg-1 mt-4 mt-lg-0">
                    <div class="card h-100 border-success">
                        <div class="card-header bg-success text-white text-center">
                            النتيجة التفصيلية
                        </div>
                        <div class="card-body">
                            <table class="table table-bordered table-hover result-table text-center align-middle">
                                <thead>
                                    <tr>
                                        <th>الوارث</th>
                                        <th>الفرض/الحالة</th>
                                        <th>السهم (القيمة)</th>
                                        <th>الدليل/التعليل</th>
                                    </tr>
                                </thead>
                                <tbody id="resultBody">
                                    <tr>
                                        <td colspan="4" class="text-muted py-5">أدخل البيانات واضغط "احسب"</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div id="totalCheck" class="text-end fw-bold mt-2 text-primary"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        function toggleSpouse() {
            const isMale = document.getElementById('genderMale').checked;
            const spouseLabel = document.getElementById('spouseLabel');
            spouseLabel.textContent = isMale ? "الزوجة" : "الزوج";
        }

        function calculateInheritance() {
            // 1. Get Inputs
            let estate = parseFloat(document.getElementById('estateValue').value) || 0;
            const isMale = document.getElementById('genderMale').checked;
            const hasSpouse = document.getElementById('hasSpouse').checked;
            const hasFather = document.getElementById('hasFather').checked;
            const hasMother = document.getElementById('hasMother').checked;
            const hasSon = document.getElementById('hasSon').checked;
            const hasDaughter = document.getElementById('hasDaughter').checked;

            let resultHTML = "";
            let remainingEstate = estate;
            
            // Determine Branch (Far' Warith)
            const hasBranch = hasSon || hasDaughter;
            const hasMaleBranch = hasSon;

            // --- 1. Spouse Share ---
            if (hasSpouse) {
                let shareFraction = 0;
                let shareText = "";
                let reason = "";

                if (isMale) { // Wife
                    if (hasBranch) {
                        shareFraction = 1/8;
                        shareText = "1/8 (الثمن)";
                        [cite_start]reason = "لوجود الفرع الوارث [cite: 286]";
                    } else {
                        shareFraction = 1/4;
                        shareText = "1/4 (الربع)";
                        [cite_start]reason = "لعدم وجود الفرع الوارث [cite: 285]";
                    }
                } else { // Husband
                    if (hasBranch) {
                        shareFraction = 1/4;
                        shareText = "1/4 (الربع)";
                        [cite_start]reason = "لوجود الفرع الوارث [cite: 282]";
                    } else {
                        shareFraction = 1/2;
                        shareText = "1/2 (النصف)";
                        [cite_start]reason = "لعدم وجود الفرع الوارث [cite: 281]";
                    }
                }
                
                let val = estate * shareFraction;
                remainingEstate -= val;
                
                resultHTML += `<tr>
                    <td>${isMale ? "الزوجة" : "الزوج"}</td>
                    <td>${shareText}</td>
                    <td>${val.toFixed(2)}</td>
                    <td><small>${reason}</small></td>
                </tr>`;
            }

            // --- 2. Parents Share ---
            
            // Father
            let fatherShareVal = 0;
            if (hasFather) {
                let fShareText = "";
                let fReason = "";
                
                if (hasMaleBranch) {
                    // With Son: Fixed 1/6
                    let val = estate * (1/6);
                    fatherShareVal = val; // Store to deduct later
                    fShareText = "1/6 (السدس)";
                    [cite_start]fReason = "لوجود الفرع الذكر [cite: 269]";
                } else if (hasDaughter) {
                    // With Daughter only: 1/6 + Asabah
                    let val = estate * (1/6);
                    fatherShareVal = val; // Plus remainder later
                    fShareText = "1/6 + الباقي (عصبة)";
                    [cite_start]fReason = "الفرض والتعصيب معاً [cite: 270]";
                } else {
                    // No children: Asabah (Takes remainder)
                    fShareText = "الباقي (عصبة)";
                    [cite_start]fReason = "التعصيب المحض [cite: 271]";
                }

                // If purely fixed share, deduct now
                if (hasMaleBranch) {
                    remainingEstate -= fatherShareVal;
                } else if (hasDaughter) {
                    remainingEstate -= fatherShareVal; // Takes 1/6 first
                }
                
                // Add row structure (value might be updated for Asabah)
                resultHTML += `<tr id="fatherRow">
                    <td>الأب</td>
                    <td>${fShareText}</td>
                    <td id="fatherVal">${hasMaleBranch || hasDaughter ? fatherShareVal.toFixed(2) : "..."}</td>
                    <td><small>${fReason}</small></td>
                </tr>`;
            }

            // Mother
            if (hasMother) {
                let mShareText = "";
                let mReason = "";
                let val = 0;

                // Simplified logic based on text (ignoring siblings count input for simplicity, assuming no siblings if not checked)
                // Note: Text says Mother gets 1/6 if Child exists OR multiple siblings exist.
                if (hasBranch) {
                    val = estate * (1/6);
                    mShareText = "1/6 (السدس)";
                    [cite_start]mReason = "لوجود الفرع الوارث [cite: 308]";
                } else {
                    // Assuming no siblings for this basic calc
                    // Omariyyat check: (Spouse + Parents only)
                    if (hasSpouse && hasFather && !hasBranch) {
                        // Mother gets 1/3 of Remainder
                        val = remainingEstate * (1/3);
                        mShareText = "ثلث الباقي";
                        [cite_start]mReason = "المسألة العمرية [cite: 313]";
                    } else {
                        val = estate * (1/3);
                        mShareText = "1/3 (الثلث)";
                        [cite_start]mReason = "لعدم الفرع والجمع من الإخوة [cite: 312]";
                    }
                }
                remainingEstate -= val;
                resultHTML += `<tr>
                    <td>الأم</td>
                    <td>${mShareText}</td>
                    <td>${val.toFixed(2)}</td>
                    <td><small>${mReason}</small></td>
                </tr>`;
            }

            // --- 3. Distribute Remainder (Asabah) ---
            
            // If Father is Asabah (No children or only Daughter)
            if (hasFather && !hasSon) {
                // If daughter exists, father already took 1/6, now takes remainder AFTER daughter.
                // If no daughter, father takes all remainder.
                // We need to calculate Daughter first.
            }

            // Children (The Branch)
            if (hasBranch) {
                if (hasSon && hasDaughter) {
                    // Mixed: 2:1 ratio
                    let remainder = remainingEstate; // Father took 1/6 already if existed
                    // Check if remaining is enough (should be)
                    resultHTML += `<tr>
                        <td>الأولاد (ابن + بنت)</td>
                        <td>الباقي (عصبة بالغير)</td>
                        <td>${Math.max(0, remainder).toFixed(2)}</td>
                        [cite_start]<td><small>للذكر مثل حظ الأنثيين [cite: 331]</small></td>
                    </tr>`;
                    remainingEstate = 0;
                } else if (hasSon) {
                    // Son only: Asabah
                    let remainder = remainingEstate;
                    resultHTML += `<tr>
                        <td>الابن</td>
                        <td>الباقي (عصبة بالنفس)</td>
                        <td>${Math.max(0, remainder).toFixed(2)}</td>
                        [cite_start]<td><small>يحوز المال أو الباقي [cite: 332]</small></td>
                    </tr>`;
                    remainingEstate = 0;
                } else if (hasDaughter) {
                    // Daughter only: 1/2
                    let dVal = estate * (1/2);
                    // Check logic: If daughter + Father. Father takes 1/6 fixed, Daughter 1/2, Father takes rest.
                    remainingEstate -= dVal;
                    resultHTML += `<tr>
                        <td>البنت</td>
                        <td>1/2 (النصف)</td>
                        <td>${dVal.toFixed(2)}</td>
                        [cite_start]<td><small>للانفراد [cite: 288]</small></td>
                    </tr>`;
                }
            }

            // Father Asabah Update
            if (hasFather && !hasSon) {
                // He takes whatever is left now
                let fatherExtra = Math.max(0, remainingEstate);
                if (fatherExtra > 0) {
                     // Need to update the Father Row visually or logically
                     // Since we appended HTML string, we'll just handle it by appending a note or summing it if I used DOM elements.
                     // For simplicity in this string builder:
                     if(hasDaughter) {
                         // He took 1/6, now adds remainder
                         let oldVal = parseFloat(fatherShareVal);
                         let totalF = oldVal + fatherExtra;
                         // Regex replace to update the specific row in resultHTML string would be messy.
                         // Let's rebuild the table or use a simple hack:
                         // Since Daughter row is added AFTER Father row, let's just append a row for "Father's Remainder"
                         resultHTML += `<tr>
                            <td>تكملة الأب</td>
                            <td>+ الباقي</td>
                            <td>${fatherExtra.toFixed(2)}</td>
                            <td><small>تعصيباً مع الفرض</small></td>
                        </tr>`;
                     } else {
                         // No kids. He takes ALL remainder.
                         // Previous Father row had "..." for value.
                         // We need to replace the placeholder using DOM after rendering, OR simpler:
                         // Just overwrite the placeholder in the string logic if I structured it differently.
                         // Let's rely on DOM update after setting innerHTML.
                     }
                }
                remainingEstate = 0;
            }

            // Render
            document.getElementById('resultBody').innerHTML = resultHTML;

            // Post-Render fixes for Father Asabah (No Kids)
            if (hasFather && !hasBranch) {
                // Father gets all remainder
                // Re-calculate pure remainder
                let fVal = estate;
                if(hasSpouse) fVal -= (isMale ? estate*0.25 : estate*0.5); // Deduct spouse
                if(hasMother) fVal -= (hasSpouse ? (isMale? (estate-estate*0.25)/3 : (estate-estate*0.5)/3) : estate/3); // Deduct mother (Omariyyah handled above logic roughly, let's trust remainingEstate calculation flow)
                
                // Actually remainingEstate variable tracks it correctly.
                // The father row is currently showing "..." or "Asabah".
                // Let's update the cell.
                const fatherCell = document.getElementById('fatherVal');
                if(fatherCell && fatherCell.innerText === "...") {
                    // Recalculate what was left for him
                    // We need to sum up what others took
                    // But wait, remainingEstate variable holds exactly what's left for him.
                    // However, we set remainingEstate to 0 inside the hasSon check.
                    // If !hasBranch, remainingEstate holds the full amount for father.
                    // But we modified remainingEstate in the Mother/Spouse blocks.
                    // So remainingEstate is correct.
                    // We just need to capture the value before we lost scope or just re-calc.
                    
                    // Simple approach: Iterate rows and sum, subtract from estate? No.
                    // Just use the variable from the calculation flow.
                    // We need to recover the value calculated in the flow.
                    // Let's run a quick patch:
                    let used = 0;
                    // Spouse
                    if(hasSpouse) used += (isMale ? (hasBranch? estate/8:estate/4) : (hasBranch? estate/4:estate/2));
                    // Mother
                    if(hasMother) {
                         if(hasBranch) used += estate/6;
                         else if(hasSpouse && hasFather) used += (estate - (isMale ? estate/4 : estate/2))/3;
                         else used += estate/3;
                    }
                    
                    let fFinal = estate - used;
                    fatherCell.innerText = fFinal.toFixed(2);
                }
            }

            // Final Remainder Check (Rad or Awl not handled in this basic script)
            if (remainingEstate > 1 && !hasFather && !hasBranch) {
                 resultHTML += `<tr class="table-warning">
                    <td>بيت المال / الرد</td>
                    <td>الباقي</td>
                    <td>${remainingEstate.toFixed(2)}</td>
                    [cite_start]<td><small>لم يوجد عصبة [cite: 249]</small></td>
                </tr>`;
                document.getElementById('resultBody').innerHTML = resultHTML;
            }
        }
    </script>
</body>
</html>
